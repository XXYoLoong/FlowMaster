# 系统更新说明

## ✅ 已完成的更新

### 1. 用户模型更新
- ✅ 添加了 `is_demo` 字段，用于标识示例账号
- ✅ 示例账号（`is_demo=True`）禁止所有写操作
- ✅ 实际账号（`is_demo=False`）可以正常进行所有操作

### 2. 数据库初始化更新
- ✅ 只创建 `admin/admin123` 示例账号（`is_demo=True`）
- ✅ 不再创建 `staff` 账号
- ✅ 实际账号需要手动在数据库中创建

### 3. 权限识别机制
- ✅ **店长权限**：通过 `role='manager'` 字段识别
- ✅ **前台员工权限**：通过 `role='staff'` 字段识别
- ✅ 系统自动根据 `role` 字段分配权限

### 4. 示例账号保护
- ✅ 所有写操作API都添加了示例账号检查
- ✅ 示例账号无法创建、修改、删除数据
- ✅ 示例账号无法创建新用户
- ✅ 前端也添加了示例账号检查，提前阻止操作

### 5. UI美化
- ✅ 现代化的渐变背景和按钮样式
- ✅ 卡片悬停效果和动画
- ✅ 表格行悬停效果
- ✅ 报表统计卡片美化
- ✅ 登录界面美化
- ✅ 标签页激活状态美化

### 6. 界面切换功能
- ✅ 原版UI添加"🤖 AI对话"按钮，点击直接切换到AI对话界面
- ✅ AI对话UI添加"原版界面"按钮，点击直接切换回原版UI
- ✅ 切换时保持登录状态，无需重新登录
- ✅ 移除了返回按钮，改为直接切换按钮

### 7. 功能补全
- ✅ 所有报表功能完整
- ✅ 数据录入、查询、修改、删除功能完整
- ✅ 员工管理功能完整
- ✅ AI对话功能完整

## 📋 使用说明

### 创建实际用户账号

#### 方法1：通过系统界面创建（推荐）

1. 使用管理员账号（`role='manager'`）登录
2. 进入"员工管理"标签页
3. 点击"添加员工"按钮
4. 填写信息：
   - **用户名**：登录用户名
   - **密码**：登录密码
   - **真实姓名**：员工姓名
   - **角色**：
     - 选择"店长" → `role='manager'`（最高权限）
     - 选择"前台员工" → `role='staff'`（只能录入和查看当日数据）

#### 方法2：直接在数据库中创建

```sql
-- 创建店长账号
INSERT INTO users (username, password_hash, role, real_name, is_active, is_demo, created_at)
VALUES (
    'manager1', 
    '<使用Python生成的密码哈希>', 
    'manager', 
    '店长姓名', 
    1, 
    0,  -- is_demo=0 表示实际账号
    NOW()
);

-- 创建前台员工账号
INSERT INTO users (username, password_hash, role, real_name, is_active, is_demo, created_at)
VALUES (
    'staff1', 
    '<使用Python生成的密码哈希>', 
    'staff', 
    '员工姓名', 
    1, 
    0,  -- is_demo=0 表示实际账号
    NOW()
);
```

**生成密码哈希的Python代码**：
```python
from werkzeug.security import generate_password_hash
password = 'your_password'
password_hash = generate_password_hash(password)
print(password_hash)
```

### 权限说明

#### 店长（`role='manager'`）
- ✅ 查看所有数据
- ✅ 生成所有报表（每日、每周、每月、年报、管理层报表）
- ✅ 管理员工（添加、查看）
- ✅ 删除流水记录
- ✅ 录入任意日期的数据

#### 前台员工（`role='staff'`）
- ✅ 只能录入当日数据
- ✅ 只能查看当日数据
- ✅ 只能查看每日报表
- ❌ 不能查看周报、月报、年报、管理层报表
- ❌ 不能管理员工
- ❌ 不能删除数据

#### 示例账号（`is_demo=True`）
- ✅ 可以查看界面
- ✅ 可以查看数据（只读）
- ❌ 不能进行任何写操作（录入、修改、删除）
- ❌ 不能创建新用户

## 🎨 UI改进

### 原版UI
- 渐变背景的顶部导航栏
- 美化的登录界面（带顶部彩色条）
- 卡片悬停效果
- 表格行悬停动画
- 报表统计卡片美化（带悬停效果）
- 标签页激活状态美化（带渐变下划线）

### AI对话UI
- 固定渐变背景
- 美化的消息气泡（带阴影）
- 快捷操作按钮美化
- 发送按钮美化（带涟漪效果）
- 欢迎消息美化

### 界面切换
- 原版UI右上角："🤖 AI对话"按钮
- AI对话UI左上角："原版界面"按钮
- 点击即可切换，保持登录状态

## 🔒 安全说明

1. **示例账号保护**：所有写操作都检查 `is_demo` 字段
2. **权限控制**：通过 `role` 字段控制功能访问
3. **数据加密**：金额明细等敏感数据加密存储
4. **JWT认证**：所有API都需要JWT Token认证

## 📝 注意事项

1. **数据库迁移**：如果已有数据库，需要添加 `is_demo` 字段：
   ```sql
   ALTER TABLE users ADD COLUMN is_demo BOOLEAN DEFAULT 0;
   UPDATE users SET is_demo = 1 WHERE username = 'admin';
   ```

2. **创建账号时**：确保 `is_demo=0`（实际账号）或 `is_demo=1`（示例账号）

3. **角色设置**：确保 `role='manager'`（店长）或 `role='staff'`（前台员工）

4. **示例账号**：`admin/admin123` 只能查看，不能进行任何数据操作

